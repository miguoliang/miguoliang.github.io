---
import { SEO } from 'astro-seo';

type TocItem = { text: string; slug: string };
const { toc = [] as TocItem[], title, description, image, pubDate, updatedDate, author } = Astro.props;

// 判断是否为首页
const isHomePage = Astro.url.pathname === '/';

// 默认 SEO 配置
const seoTitle = title || (isHomePage ? 'Guoliang Mi' : 'Guoliang Mi | Blog');
const seoDescription = description || (isHomePage ? 'Where AI meets human potential.' : '');
const canonical = Astro.url.href;
const siteUrl = Astro.site || new URL(Astro.url.pathname, Astro.url.origin).origin;
const ogImage = image || `${siteUrl}/og-image.png`;
---
<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="generator" content={Astro.generator} />
		<SEO
			title={seoTitle}
			description={seoDescription}
			canonical={canonical}
			openGraph={{
				basic: {
					title: seoTitle,
					type: isHomePage ? 'website' : 'article',
					image: ogImage,
					url: canonical,
				},
				optional: {
					siteName: 'Guoliang Mi',
				},
				...(pubDate && {
					article: {
						publishedTime: pubDate.toISOString(),
						...(updatedDate && { modifiedTime: updatedDate.toISOString() }),
						...(author && { authors: [author] }),
					},
				}),
			}}
		/>
	</head>
	<body>
		<div class="container">
			<aside>
				{Astro.url.pathname === '/' ? (
					<div class="profile">
						<div class="profile-photo">
							<!-- Add your photo here -->
							<div class="photo-placeholder">Photo</div>
						</div>
						<div class="profile-info">
							<h2>Guoliang Mi</h2>
							<p class="profile-bio">Where AI meets human potential.</p>
						</div>
					</div>
				) : (
					<>
						<div class="sidebar-nav">
							<a href="/">← Back to Home</a>
						</div>
						{toc.length > 0 && (
							<nav class="toc">
								<h3>Contents</h3>
								<ul>
									{toc.map((heading) => (
										<li>
											<a href={`#${heading.slug}`}>{heading.text}</a>
										</li>
									))}
								</ul>
							</nav>
						)}
					</>
				)}
			</aside>
			<main>
				<slot />
			</main>
		</div>
	</body>
</html>

<style>
	body {
		margin: 0;
		padding: 0;
		overflow: hidden; /* Prevent body scrolling */
	}
	
	.container {
		display: flex;
		min-height: 100vh;
		position: fixed;
		top: 0;
		left: 0;
		right: 0;
		bottom: 0;
		overflow: hidden;
	}
	
	aside {
		width: 250px;
		padding: 2rem;
		border-right: 1px solid #e0e0e0;
		display: flex;
		flex-direction: column;
		overflow: hidden;
	}
	
	main {
		flex: 1;
		padding: 2rem;
		overflow-y: auto;
	}
	
	.profile {
		margin-bottom: 2rem;
	}
	
	.profile-photo {
		width: 120px;
		height: 120px;
		margin: 0 auto 1rem;
		border-radius: 50%;
		background: #f0f0f0;
		display: flex;
		align-items: center;
		justify-content: center;
		color: #999;
	}
	
	.photo-placeholder {
		font-size: 0.9rem;
	}
	
	.profile-info h2 {
		margin: 0 0 0.5rem 0;
		font-size: 1.2rem;
		text-align: center;
	}
	
	.profile-bio {
		margin: 0;
		font-size: 0.9rem;
		color: #666;
		line-height: 1.4;
		text-align: center;
	}
	
	.sidebar-nav {
		margin-top: 1rem;
		margin-bottom: 1rem;
	}
	
	.sidebar-nav a {
		text-decoration: none;
		color: #666;
		font-size: 0.9rem;
	}
	
	.sidebar-nav a:hover {
		color: #000;
	}
	
	.toc {
		flex: 1;
		overflow-y: auto;
	}
	
	.toc h3 {
		margin: 0 0 1rem 0;
		font-size: 1rem;
		position: sticky;
		top: 0;
		background: white;
		padding-bottom: 0.5rem;
	}
	
	.toc ul {
		list-style: none;
		padding: 0;
		margin: 0;
	}
	
	.toc li {
		margin-bottom: 0.5rem;
	}
	
	.toc a {
		text-decoration: none;
		color: #666;
		font-size: 0.9rem;
	}
	
	.toc a:hover {
		color: #000;
	}
</style>
