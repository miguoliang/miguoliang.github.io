---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';

export async function getStaticPaths() {
	const blogPosts = await getCollection('blog');
	return blogPosts.map((post) => ({
		params: { slug: post.slug },
		props: post,
	}));
}

const post = Astro.props;
const { Content, headings } = await post.render();

// Extract headings for TOC
const toc = headings
	.filter((h) => h.depth === 2) // Only h2 headings
	.map((h) => ({
		text: h.text,
		slug: h.slug,
	}));
---

<Layout 
	toc={toc}
	title={post.data.title}
	description={post.data.description}
	image={post.data.image}
	pubDate={post.data.pubDate}
	updatedDate={post.data.updatedDate}
	author={post.data.author}
>
	<article>
		<header>
			<time>
				{post.data.pubDate.toLocaleDateString('en-US', {
					year: 'numeric',
					month: 'long',
					day: 'numeric',
				})}
			</time>
		</header>
		<Content />
	</article>
</Layout>

<style>
	article {
		font-size: 1.05rem;
		line-height: 1.8;
		letter-spacing: 0.01em;
		color: var(--text-color);
		padding-bottom: 4rem;
		transition: color 0.3s ease;
	}
	
	article header {
		margin-bottom: 2rem;
	}
	
	article header time {
		font-size: 0.95rem;
		text-transform: uppercase;
		letter-spacing: 0.2em;
		color: var(--text-muted);
		transition: color 0.3s ease;
	}
	
	article :global(h1) {
		font-size: 2.25rem;
		font-weight: 700;
		margin-top: 0;
		margin-bottom: 2rem;
		line-height: 1.3;
		color: var(--text-color);
		padding-bottom: 1.5rem;
		border-bottom: 2px solid var(--border-color);
		transition: color 0.3s ease, border-color 0.3s ease;
	}
	
	article :global(h2),
	article :global(h3) {
		margin-top: 2.5rem;
		margin-bottom: 1rem;
		line-height: 1.4;
	}
	
	article :global(p) {
		margin-top: 0;
		margin-bottom: 1.25rem;
	}
	
	article :global(ol),
	article :global(ul) {
		padding-left: 1.2rem;
		margin-bottom: 1.5rem;
	}
	
	article :global(li) {
		margin-bottom: 0.5rem;
	}
	
	article :global(a) {
		color: var(--link-color);
		text-decoration: underline;
		transition: color 0.2s ease;
	}
	
	article :global(a:hover) {
		color: var(--link-hover);
	}
	
	article :global(code) {
		background: var(--border-color);
		color: var(--text-color);
		padding: 0.2em 0.4em;
		border-radius: 3px;
		font-size: 0.9em;
		transition: background-color 0.3s ease, color 0.3s ease;
	}
	
	article :global(pre) {
		background: var(--border-color);
		color: var(--text-color);
		padding: 1rem;
		border-radius: 4px;
		overflow-x: auto;
		transition: background-color 0.3s ease, color 0.3s ease;
	}
	
	article :global(pre code) {
		background: none;
		padding: 0;
	}
	
	@media (max-width: 720px) {
		article :global(h1) {
			font-size: 1.75rem;
			margin-bottom: 1.5rem;
			padding-bottom: 1rem;
		}
	}
	
	@media (max-width: 520px) {
		article :global(h1) {
			font-size: 1.5rem;
		}
	}
</style>
